/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   fract_ol.h                                         :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: gbohm <gbohm@student.42.fr>                +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2022/12/12 14:40:49 by gbohm             #+#    #+#             */
/*   Updated: 2022/12/18 20:47:13 by gbohm            ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef FRACT_OL_H
# define FRACT_OL_H

# include <stdlib.h>
# include "MLX42/MLX42.h"

# define DEFAULT_ZOOM 5
# define DEFAULT_ITERATIONS 100
# define DEFAULT_WIDTH 256
# define DEFAULT_HEIGHT 256

# define FONT "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000001000000100000010000001000000100000010000000000000100000000000000000000000000000000010100001010000101000000000000000000000000000000000000000000000000000000000000000000000000001001000100100111111001001000100100010010011111100100100010010000000000000000001000000100000111000101010010100001010000011100000101000010100101010001110000010000001000000000000000000100000101000010100100100100000100000100100100101000010100000100000000000000000000000000000001110001000100100000010000000111000100010010001001000100011110000000000000000000000000000000010000001000000100000000000000000000000000000000000000000000000000000000000000000000000000000010000010000010000001000000100000010000001000000010000000100000000000000000000000000000010000000100000001000000100000010000001000000100000100000100000000000000000000000000000000000010000101010001110001010100001000000000000000000000000000000000000000000000000000000000000000000000000000010000001000011111000010000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000100000100000000000000000000000000000000000000000000000011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000010000001000000100000100000010000001000001000000100000010000000000000000000000000000000000111000100010010001001001100101010011001001000100100010001110000000000000000000000000000000001000001100001010000001000000100000010000001000000100001111100000000000000000000000000000001110001000100000010000010000010000010000010000001000000111110000000000000000000000000000000111000100010000001000000100001100000001000000100100010001110000000000000000000000000000000000010000011000010100010010010001001111100000010000001000000100000000000000000000000000000011111001000000100000011110000000100000010000001001000100011100000000000000000000000000000000111000100010010000001000000111100010001001000100100010001110000000000000000000000000000000111110000001000000100000100000100000100000100000010000001000000000000000000000000000000000001110001000100100010010001000111000100010010001001000100011100000000000000000000000000000000111000100010010001001000100011110000001000000100100010001110000000000000000000000000000000000000000000000010000000000000000000000000000000000000000010000000000000000000000000000000000000000000000001000000000000000000000000000000000000000001000000100000100000000000000000000000000000000000010000010000010000000100000001000000000000000000000000000000000000000000000000000000000000000000011110000000000111100000000000000000000000000000000000000000000000000000000000000000010000000100000001000001000001000000000000000000000000000000000000000000000000111000100010000001000001000001000000100000010000000000000100000000000000000000000000000000111110100000110011011010101101010110101011001110100000001111100000000000000000000000000000001110001000100100010010001001000100111110010001001000100100010000000000000000000000000000001111000100010010001001000100111100010001001000100100010011110000000000000000000000000000000011100010001001000000100000010000001000000100000010001000111000000000000000000000000000000011110001000100100010010001001000100100010010001001000100111100000000000000000000000000000001111100100000010000001000000111000010000001000000100000011111000000000000000000000000000000111110010000001000000100000011100001000000100000010000001000000000000000000000000000000000001110001000100100000010000001001100100010010001001000100011110000000000000000000000000000001000100100010010001001000100111110010001001000100100010010001000000000000000000000000000000111110000100000010000001000000100000010000001000000100001111100000000000000000000000000000000111100000100000010000001000000100000010000001001000100011100000000000000000000000000000001000100100010010010001010000110000010100001001000100010010001000000000000000000000000000000100000010000001000000100000010000001000000100000010000001111100000000000000000000000000000100000110000011100011101010110010011000001100000110000011000001000000000000000000000000000001000100100010010001001100100101010010011001000100100010010001000000000000000000000000000000011100010001001000100100010010001001000100100010010001000111000000000000000000000000000000011110001000100100010010001001111000100000010000001000000100000000000000000000000000000000000111000100010010001001000100100010010001001010100100100001101000000000000000000000000000000111100010001001000100100010011110001010000100100010001001000100000000000000000000000000000001110001000100100000010000000111000000010000001001000100011100000000000000000000000000000001111100001000000100000010000001000000100000010000001000000100000000000000000000000000000000100010010001001000100100010010001001000100100010010001000111000000000000000000000000000000010001001000100100010010001001000100100010010001000101000001000000000000000000000000000000010000011000001100100110010011001001100100110010011001001011011000000000000000000000000000000100010010001001000100010100000100000101000100010010001001000100000000000000000000000000000010001001000100100010001010000010000001000000100000010000001000000000000000000000000000000001111100000010000001000001000001000001000001000000100000011111000000000000000000000000000000001110000100000010000001000000100000010000001000000100000011100000000000000000000000000000001000000100000010000000100000010000001000000010000001000000100000000000000000000000000000001110000001000000100000010000001000000100000010000001000011100000000000000000000000000000000001000001010001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111110000000000000000100000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111000100010000001000111100100010010001000111100000000000000000000000000000010000001000000111100010001001000100100010010001001000100111100000000000000000000000000000000000000000000001110001000100100000010000001000000100010001110000000000000000000000000000000000010000001000111100100010010001001000100100010010001000111100000000000000000000000000000000000000000000011100010001001000100111110010000001000100011100000000000000000000000000000000001100001000000100000111100001000000100000010000001000000100000000000000000000000000000000000000000000000111100100010010001001000100100010001111000000100100010001110000000000000000010000001000000111100010001001000100100010010001001000100100010000000000000000000000000000000010000000000011100000010000001000000100000010000001000011111000000000000000000000000000000000010000000000011100000010000001000000100000010000001000000100100010001110000000000000000010000001000000100010010010001010000110000010100001001000100010000000000000000000000000000001110000001000000100000010000001000000100000010000001000011111000000000000000000000000000000000000000000011101101001001100100110010011001001100000110000010000000000000000000000000000000000000000000111100010001001000100100010010001001000100100010000000000000000000000000000000000000000000001110001000100100010010001001000100100010001110000000000000000000000000000000000000000000001111000100010010001001000100100010010001001111000100000010000000000000000000000000000000000011110010001001000100100010010001001000100011110000001000000100000000000000000000000000000010011001010000110000010000001000000100000010000000000000000000000000000000000000000000000000111000100010010000000111000000010010001000111000000000000000000000000000000000000000010000011110000100000010000001000000100000010000000110000000000000000000000000000000000000000000010001001000100100010010001001000100100010001110000000000000000000000000000000000000000000001000100100010010001001000100100010001010000010000000000000000000000000000000000000000000001000001100000110010011001001100100110010010110110000000000000000000000000000000000000000000010001001000100010100000100000101000100010010001000000000000000000000000000000000000000000001000100100010010001001000100100010001111000000100100010001110000000000000000000000000000000111110000001000001000001000001000001000000111110000000000000000000000000000000001100001000000100000010000010000000100000010000001000000011000000000000000000000000000000001000000100000010000001000000100000010000001000000100000010000000000000000000000000000000011000000010000001000000100000001000001000000100000010000110000000000000000000000000000000000110010100110000000000000000000000000000000000000000000000000000000000000000"
# define CHAR_WIDTH 7
# define CHAR_HEIGHT 13
# define PADDING 5
# define CHAR_PADDING 1
# define LINE_PADDING 1
# define FONT_SIZE 1

typedef enum e_renderer {
	RENDERER_CPU,
	RENDERER_GPU_DOUBLE,
	RENDERER_GPU_FLOAT,
}	t_renderer;

typedef enum e_color_component {
	R,
	G,
	B,
	A,
}	t_color_component;

typedef enum e_op {
	OP_NONE,
	OP_NEG,
	OP_ABS,
	OP_SIN,
	OP_COS,
	OP_TAN,
	OP_ASIN,
	OP_ATAN,
	OP_CSC,
	OP_SEC,
	OP_COT,
	OP_EXP,
	OP_ZERO,
	OP_INVALID,
}	t_op;

typedef enum e_type {
	TYPE_MANDELBROT,
	TYPE_JULIA,
}	t_type;

typedef struct s_vec2 {
	double	x;
	double	y;
}	t_vec2;

typedef struct s_ops {
	t_op	re;
	t_op	im;
}	t_ops;

typedef struct s_scene {
	mlx_t		*mlx;
	uint32_t	width;
	uint32_t	height;
	mlx_image_t	*img;
	mlx_image_t	*info_img;
	double		aspect;
	double		zoom;
	t_vec2		mouse;
	t_vec2		offset;
	int			iterations;
	float		time;
	t_renderer	renderer;
	t_ops		fractal;
	t_ops		julia;
	t_type		type;
}	t_scene;

int		setup_scene2(t_scene *scene);
void	setup_hooks(t_scene *scene);

t_vec2	vec2(double x, double y);
t_vec2	vec2_add(t_vec2 v1, t_vec2 v2);
t_vec2	vec2_sub(t_vec2 v1, t_vec2 v2);
t_vec2	vec2_div_scalar(t_vec2 v, double s);
t_vec2	vec2_mult_scalar(t_vec2 v, double s);

t_vec2	mandelbrot(t_vec2 z, t_vec2 c);
t_vec2	tricorn(t_vec2 z, t_vec2 c);
t_vec2	burning_ship(t_vec2 z, t_vec2 c);

t_vec2	complex_mult(t_vec2 z1, t_vec2 z2);
t_vec2	complex_add(t_vec2 z1, t_vec2 z2);
double	complex_modulus_squared(t_vec2 z);

void	on_loop(void *param);
void	on_resize(int32_t width, int32_t height, void *param);
void	on_scroll(double xdelta, double ydelta, void *param);
void	on_keydown(mlx_key_data_t key, void *param);

void	color_pixel(t_scene *scene, int x, int y, int result);

void	calculate(t_scene *scene);
void	render_info(t_scene *scene);

int		malloc2(size_t size, char **str);
int		dtoa2(double value, char **str);
t_ops	ops(t_op re, t_op im);
t_vec2	apply_op_double(double v, t_ops ops);
t_vec2	apply_op_vec2(t_vec2 v, t_ops ops);

void	update_uniforms(t_scene *scene);

t_op	get_op_for_key(keys_t key);

void	update_iterations(t_scene *scene, int *rerender);
void	update_time(t_scene *scene, int *rerender);
void	update_mouse(t_scene *scene, int *rerender);
void	update_ops(t_scene *scene, mlx_key_data_t key, int *rerender);
void	update_settings(t_scene *scene, keys_t key, int *rerender);

int		get_info_str2(t_scene *scene, char **str);
int		get_rows(char *str);
int		get_columns(char *str);
char	*get_renderer(t_scene *scene);
char	*get_op(t_op op);
char	*get_type(t_scene *scene);

#endif